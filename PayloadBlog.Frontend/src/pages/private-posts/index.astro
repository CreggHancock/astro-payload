---
import BlogListing from "../../components/BlogListing.astro";
import Layout from "../../layouts/Layout.astro";
import "./index.less";

export const prerender = false;

var cookie = Astro.cookies.get("payload-token");

if (!cookie) {
  return Astro.redirect("/");
}

const res = await fetch("http://localhost:3000/api/private-posts", {
  credentials: "include",
  headers: {
    Cookie: `payload-token=${cookie.value};`,
  },
});

if (res.status === 403) {
  return Astro.redirect("/");
}

const posts: any = await res.json();
---

<Layout>
  <h1>Astro + PayloadCMS ðŸš€</h1>
  <BlogListing posts={posts.docs} postRoute="private-posts/" />
  <div></div>
</Layout>
